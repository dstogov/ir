name: Push
on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - "**"
permissions:
  contents: read
jobs:
  Linux_x86_64:
    name: 'Linux x86_64'
    runs-on: ubuntu-22.04
    container:
      image: ubuntu:22.04
    env:
      CFLAGS: '-fsanitize=address,undefined'
      ASAN_OPTIONS: detect_leaks=0
    steps:
      - uses: actions/checkout@v3
      - name: apt
        run: |
          apt update -y
          DEBIAN_FRONTEND=noninteractive apt install -y \
            gcc \
            libcapstone-dev \
            libcapstone4 \
            make
      - name: make
        run: make TARGET=x86_64 all
      - name: test
        run: make TARGET=x86_64 test-ci
